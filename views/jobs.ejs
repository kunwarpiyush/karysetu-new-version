<!DOCTYPE html>
<html lang="hi">

<head>
  <meta charset="UTF-8" />
  <title><%= pageTitle %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#f97316',
            soft: '#f8fafc'
          },
          boxShadow: {
            soft: '0 15px 35px rgba(0,0,0,0.08)'
          }
        }
      }
    }
  </script>
</head>

<body class="bg-soft text-gray-800 min-h-screen">

  <!-- NAVBAR -->
  <%- include('partials/header') %>

  <!-- PAGE HEADER -->
  <section class="max-w-7xl mx-auto px-4 py-12">
    <h1 class="text-3xl md:text-4xl font-extrabold">
      рдЙрдкрд▓рдмреНрдз <span class="text-primary">рдХрд╛рдо</span>
    </h1>
    <p class="text-gray-500 mt-2">
      рдЕрдкрдиреЗ рдкрд╛рд╕ рдХрд╛ рд╕рд╣реА рдХрд╛рдо рдЪреБрдиреЗрдВ
    </p>
  </section>

  <!-- SEARCH (UI ONLY) -->
  <section class="max-w-7xl mx-auto px-4">
    <div class="bg-white rounded-3xl shadow-soft p-6 grid grid-cols-1 md:grid-cols-4 gap-4">

      <input type="text" placeholder="ЁЯФН рдХрд╛рдо рдХрд╛ рдирд╛рдо"
        class="border rounded-2xl px-4 py-3 focus:outline-primary">

      <input type="text" placeholder="ЁЯУН рд╢рд╣рд░ / рдЗрд▓рд╛рдХрд╛"
        class="border rounded-2xl px-4 py-3 focus:outline-primary">

      <select class="border rounded-2xl px-4 py-3 text-gray-600">
        <option>ЁЯТ░ рд╕реИрд▓рд░реА</option>
        <option>тВ╣300 тАУ тВ╣500</option>
        <option>тВ╣500 тАУ тВ╣800</option>
        <option>тВ╣800+</option>
      </select>

      <button class="bg-primary text-white rounded-2xl font-semibold shadow hover:bg-orange-600">
        Search
      </button>

    </div>
  </section>

  <!-- JOBS GRID -->
  <section class="max-w-7xl mx-auto px-4 mt-16 pb-24">

    <% if (jobs.length === 0) { %>
      <div class="bg-white rounded-3xl shadow-soft p-10 text-center text-gray-500">
        ЁЯЪл рдЕрднреА рдХреЛрдИ рдХрд╛рдо рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ
      </div>
    <% } %>

    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">

      <% jobs.forEach(job => { %>
      <div class="bg-white rounded-[2.2rem] shadow-soft hover:shadow-xl transition p-7 flex flex-col">

        <!-- TITLE -->
        <h3 class="text-xl font-extrabold mb-2">
          <%= job.title %>
        </h3>

        <!-- META -->
        <p class="text-sm text-gray-500 mb-4">
          ЁЯУН <%= job.location %>
          <% if (job.jobTime) { %>
            тАв ЁЯХТ <%= job.jobTime %>
          <% } %>
        </p>

        <!-- TAGS -->
        <div class="flex flex-wrap gap-3 text-sm mb-5">
          <% if (job.salary) { %>
            <span class="bg-orange-100 text-primary px-4 py-1 rounded-full font-semibold">
              тВ╣ <%= job.salary %>
            </span>
          <% } %>

          <span class="bg-gray-100 text-gray-600 px-4 py-1 rounded-full">
            рддреБрд░рдВрдд рдЬреЙрдЗрди
          </span>
        </div>

        <!-- DESCRIPTION -->
        <% if (job.description) { %>
          <p class="text-gray-600 text-sm leading-relaxed mb-6 line-clamp-3">
            <%= job.description %>
          </p>
        <% } %>

        <!-- ACTIONS -->
        <div class="mt-auto flex gap-4">

          <!-- DETAILS -->
          <a href="/jobs/<%= job._id %>"
            class="flex-1 text-center border border-orange-300 text-primary
                   py-3 rounded-2xl font-semibold hover:bg-orange-50 transition">
            Details
          </a>

          <!-- APPLY LOGIC -->
          <% if (isLoggedIn && role === 'worker') { %>

            <% if (job.applicants && job.applicants.some(a => a.toString() === user._id.toString())) { %>

              <!-- ALREADY APPLIED (SHORT MESSAGE) -->
              <button disabled
                class="flex-1 bg-green-100 text-green-700 py-3 rounded-2xl
                       font-bold cursor-not-allowed">
                тЬФ
              </button>

            <% } else { %>

              <!-- APPLY -->
              <form action="/jobs/<%= job._id %>/apply" method="POST" class="flex-1">
                <button type="submit"
                  class="w-full bg-primary text-white py-3 rounded-2xl
                         font-semibold hover:bg-orange-600 transition">
                  Apply
                </button>
              </form>

            <% } %>

          <% } else if (isLoggedIn && role === 'employer') { %>

            <!-- EMPLOYER -->
            <button disabled
              class="flex-1 bg-gray-100 text-gray-500 py-3 rounded-2xl font-semibold">
              Apply
            </button>

          <% } else { %>

            <!-- NOT LOGGED IN -->
            <a href="/login"
              class="flex-1 text-center bg-primary text-white py-3
                     rounded-2xl font-semibold hover:bg-orange-600 transition">
              Apply
            </a>

          <% } %>

        </div>

      </div>
      <% }) %>

    </div>

  </section>

  <!-- FOOTER -->
  <footer class="bg-white border-t border-orange-100 py-12">
    <div class="text-center">
      <h3 class="text-primary font-extrabold text-lg">ROJGAR APP</h3>
      <p class="text-gray-500 mt-2">рднрд░реЛрд╕реЗрдордВрдж тАв рддреЗрдЬрд╝ тАв рдЖрд╕рд╛рди</p>
      <p class="text-xs text-gray-400 mt-3">┬й 2026 All Rights Reserved</p>
    </div>
  </footer>

</body>
</html>
