<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title><%= pageTitle %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#f97316',
            soft: '#fff7ed',
            whitepure: '#ffffff',
            other: '#64748b'
          },
          boxShadow: {
            soft: '0 20px 45px rgba(0,0,0,0.08)',
            glow: '0 20px 40px rgba(249,115,22,0.45)'
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gradient-to-br from-orange-50 via-whitepure to-orange-100 min-h-screen text-gray-800">

<%- include('partials/header') %>

<main class="max-w-6xl mx-auto px-4 py-20">

<% if (!isLoggedIn) { %>

  <!-- NOT LOGGED IN -->
  <div class="bg-whitepure rounded-[3rem] shadow-soft p-16 text-center">
    <h2 class="text-3xl font-extrabold text-primary mb-4">
      рдЖрдк рд▓реЙрдЧрд┐рди рдирд╣реАрдВ рд╣реИрдВ
    </h2>
    <p class="text-other mb-10">
      рдкреНрд░реЛрдлрд╛рдЗрд▓ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ
    </p>
    <a href="/login"
       class="inline-block bg-primary text-white px-14 py-4 rounded-2xl font-bold shadow-glow hover:scale-105 transition">
      рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ
    </a>
  </div>

<% } else { %>

<%
  let maskedAadhar = 'рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ';
  if (user.Aadhar_cardNumber) {
    maskedAadhar = 'XXXX XXXX ' + user.Aadhar_cardNumber.slice(-4);
  }
%>

<!-- ================= PROFILE HEADER ================= -->
<div class="bg-whitepure rounded-[3.5rem] shadow-soft p-12 mb-20 border border-orange-100">

  <div class="flex flex-col md:flex-row gap-12 items-center">

    <div class="w-32 h-32 rounded-full bg-primary text-white
                flex items-center justify-center text-6xl font-extrabold shadow-glow">
      <%= user.Name.charAt(0).toUpperCase() %>
    </div>

    <div class="flex-1">
      <h2 class="text-4xl font-extrabold mb-3">
        <%= user.Name %>
      </h2>

      <span class="inline-block px-6 py-2 rounded-full text-xs font-bold mb-6
        <%= role === 'employer'
          ? 'bg-orange-100 text-primary'
          : 'bg-slate-100 text-slate-700' %>">
        <%= role === 'employer' ? 'ЁЯПв рдХрд╛рдо рджреЗрдиреЗ рд╡рд╛рд▓рд╛' : 'ЁЯС╖ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓рд╛' %>
      </span>

      <div class="grid sm:grid-cols-2 gap-6">
        <div class="bg-soft rounded-2xl p-6">
          <p class="text-xs text-other">ЁЯУ▒ рдореЛрдмрд╛рдЗрд▓</p>
          <p class="font-bold"><%= user.Mobile %></p>
        </div>

        <div class="bg-soft rounded-2xl p-6">
          <p class="text-xs text-other">ЁЯЖФ рдЖрдзрд╛рд░</p>
          <p class="font-bold tracking-widest"><%= maskedAadhar %></p>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ================= WORKER ACCEPTED ================= -->
<% if (role === 'worker' && acceptedJobs.length > 0) { %>
<div class="bg-green-50 border-l-8 border-green-600 rounded-[3rem] p-10 mb-12">
  <h3 class="text-2xl font-extrabold text-green-700 mb-6">
    тЬФ рдЖрдкрдХрд╛ рдХрд╛рдо рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛
  </h3>

  <% acceptedJobs.forEach(job => { %>
    <div class="bg-whitepure p-6 rounded-2xl mb-4">
      <p class="font-bold"><%= job.title %></p>
      <p class="text-sm">ЁЯУН <%= job.location %></p>
      <p class="text-green-700 text-sm mt-1">
        рдХрд╛рдо рджреЗрдиреЗ рд╡рд╛рд▓рд╛: <%= job.employer?.Name %>
      </p>
    </div>
  <% }) %>
</div>
<% } %>

<!-- ================= WORKER REJECTED ================= -->
<% if (role === 'worker' && rejectedJobs.length > 0) { %>
<div class="bg-orange-50 border-l-8 border-primary rounded-[3rem] p-10 mb-12">
  <h3 class="text-2xl font-extrabold text-primary mb-6">
    тЭМ рдХрд╛рдо рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛
  </h3>

  <% rejectedJobs.forEach(job => { %>
    <div class="bg-whitepure p-6 rounded-2xl mb-4">
      <p class="font-bold"><%= job.title %></p>
      <p class="text-sm">ЁЯУН <%= job.location %></p>
      <p class="text-red-600 text-sm mt-1">
        рдХрд╛рдо рджреЗрдиреЗ рд╡рд╛рд▓рд╛: <%= job.employer?.Name %>
      </p>
    </div>
  <% }) %>
</div>
<% } %>

<!-- ================= EMPLOYER DASHBOARD ================= -->
<% if (role === 'employer') { %>

<h3 class="text-3xl font-extrabold mb-10">
  ЁЯУЛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдбрд╛рд▓реЗ рдЧрдП рдХрд╛рдо
</h3>

<% postedJobs.forEach(job => { %>

<div class="bg-whitepure rounded-[3rem] shadow-soft p-10 mb-12">

  <h4 class="text-2xl font-extrabold"><%= job.title %></h4>
  <p class="text-sm text-other mb-4">ЁЯУН <%= job.location %></p>

  <p class="text-primary font-semibold mb-6">
    ЁЯСе рдЖрд╡реЗрджрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ: <%= job.applicants.length %>
  </p>

  <% if (job.applicants.length > 0) { %>

    <% job.applicants.forEach(applicant => { %>

    <div class="flex justify-between items-center bg-soft p-5 rounded-2xl mb-3">

      <div>
        <p class="font-bold">ЁЯС╖ <%= applicant.Name %></p>
        <p class="text-sm">ЁЯУ▒ <%= applicant.Mobile %></p>
      </div>

      <div class="flex gap-2">

        <form method="POST"
          action="/jobs/<%= job._id %>/applicants/<%= applicant._id %>/accept">
          <button class="bg-green-600 text-white px-4 py-2 rounded-xl">
            тЬФ рд╕реНрд╡реАрдХрд╛рд░
          </button>
        </form>

        <form method="POST"
          action="/jobs/<%= job._id %>/applicants/<%= applicant._id %>/reject">
          <button class="bg-orange-500 text-white px-4 py-2 rounded-xl">
            тЭМ рдЕрд╕реНрд╡реАрдХрд╛рд░
          </button>
        </form>

        <form method="POST"
          action="/jobs/<%= job._id %>/applicants/<%= applicant._id %>/remove">
          <button class="bg-red-600 text-white px-4 py-2 rounded-xl">
            ЁЯЧС рд╣рдЯрд╛рдПрдВ
          </button>
        </form>

      </div>

    </div>

    <% }) %>

  <% } else { %>
    <p class="text-sm text-gray-500">
      рдЕрднреА рдХреЛрдИ рдЖрд╡реЗрджрди рдирд╣реАрдВ рдЖрдпрд╛ рд╣реИред
    </p>
  <% } %>

</div>

<% }) %>
<% } %>

<% } %>

</main>
</body>
</html>
